-- =============================================================================
-- 数据库迁移：移除废弃的 preview 字段
-- =============================================================================
-- 执行方式：在 Supabase SQL Editor 中复制粘贴此脚本并执行
-- 迁移日期：2026-01-13
-- 说明：水印现在在图片生成时由 API 直接添加，不再需要分别存储预览图和原图
-- =============================================================================

-- 1. 删除无用的索引（如果存在）
DROP INDEX IF EXISTS public.idx_images_preview_key;

-- 2. 删除废弃的列
ALTER TABLE public.images 
  DROP COLUMN IF EXISTS preview_key,
  DROP COLUMN IF EXISTS preview_url;

-- =============================================================================
-- 迁移完成
-- =============================================================================
-- 验证步骤：
-- 1. 检查列是否已删除：
--    SELECT column_name FROM information_schema.columns 
--    WHERE table_name = 'images';
--    （应该只有 id, task_id, user_id, original_key, created_at）
-- =============================================================================
